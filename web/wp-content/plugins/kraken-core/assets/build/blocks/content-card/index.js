(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const r=window.wp.i18n,l=window.wp.serverSideRender;var a=e.n(l);const s=window.wp.blockEditor,i=window.wp.element,c=window.wp.components,p=window.wp.data,d=window.wp.coreData,u=window.wp.apiFetch;var y=e.n(u);const m=window.ReactJSXRuntime;function b(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?b(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}const f=(e,t,o,n="customAdditionalContent")=>{const r=[];return Object.entries(e).forEach(([e,l])=>{var a,i;const p=null!==(a=null===(i=t[n])||void 0===i?void 0:i[e])&&void 0!==a?a:l.default;switch(l.type){case"boolean":r.push((0,m.jsx)(c.ToggleControl,{label:l.label||e,checked:p,onChange:r=>{o({[n]:g(g({},t[n]),{},{[e]:r})})}},e));break;case"string":r.push((0,m.jsx)(c.TextControl,{label:l.label||e,value:p,onChange:r=>{o({[n]:g(g({},t[n]),{},{[e]:r})})}},e));break;case"media":r.push((0,m.jsx)(s.MediaUploadCheck,{children:(0,m.jsx)(s.MediaUpload,{label:l.label||e,allowedTypes:["image"],onSelect:t=>{o({[n]:{[e]:{id:t.id,url:t.url}}})},value:p.id,render:({open:t})=>(0,m.jsxs)("div",{className:"image-select",children:[(0,m.jsx)(c.Button,{onClick:t,isLarge:!0,icon:"format-gallery",children:l.label||e}),""!=p.url&&(0,m.jsx)(c.ResponsiveWrapper,{children:(0,m.jsx)("img",{src:p.url})})]})})}));break;case"number":r.push((0,m.jsx)(c.__experimentalNumberControl,{label:l.label||e,value:p,min:l.min||0,max:l.max||100,onChange:r=>{o({[n]:g(g({},t[n]),{},{[e]:Number(r)})})}},e));break;case"select":l.options&&Array.isArray(l.options)&&r.push((0,m.jsx)(c.SelectControl,{label:l.label||e,value:p,options:l.options,onChange:r=>{o({[n]:g(g({},t[n]),{},{[e]:r})})}},e));break;case"textarea":r.push((0,m.jsx)(c.TextareaControl,{label:l.label||e,value:p,onChange:r=>{o({[n]:g(g({},t[n]),{},{[e]:r})})}},e));break;default:console.warn(`Unknown control type: ${l.type} for key: ${e}`)}}),r},h=()=>{const e=KrakenThemeSettings.blockData.cardStyles||{},t=e.add||[],o=e.remove||[];let n=[{label:"Default",value:"default"},{label:"Overlay",value:"overlay"},{label:"Overlay Partial",value:"overlay-partial"},{label:"Text Only",value:"text-only"}];return n=n.filter(e=>!o.includes(e.value)),t.forEach(e=>{n.push(e)}),n},{useSelect:j}=wp.data,C=e=>{const{attributes:t,setAttributes:o}=e,n=j(t=>t("core/block-editor").getBlockName(e.clientId));return(0,m.jsxs)(m.Fragment,{children:["queried_post"!==t.postType&&"kraken-core/content-card"===n&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Custom Title"),checked:t.displayCustomTitle,onChange:()=>{o({displayCustomTitle:!t.displayCustomTitle})}}),t.displayCustomTitle&&(0,m.jsx)(c.TextareaControl,{label:(0,r.__)("Customize Title Text"),value:t.customTitle,onChange:e=>{o({customTitle:e})}}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Custom Image"),checked:t.displayCustomImage,onChange:()=>{o({displayCustomImage:!t.displayCustomImage})}}),t.displayCustomImage&&(0,m.jsx)(s.MediaUploadCheck,{children:(0,m.jsx)(s.MediaUpload,{title:(0,r.__)("Upload Image"),allowedTypes:["image"],onSelect:e=>{o({customImage:{id:e.id,url:e.url}})},value:t.customImage.id,render:({open:e})=>(0,m.jsxs)("div",{className:"image-select",children:[(0,m.jsx)(c.Button,{onClick:e,isLarge:!0,icon:"format-gallery",children:(0,r.__)("Select Image")}),""!=t.customImage.url&&(0,m.jsx)(c.ResponsiveWrapper,{children:(0,m.jsx)("img",{src:t.customImage.url})})]})})})]}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Display Additional Content?"),checked:t.displayAdditionalContent,onChange:()=>{o({displayAdditionalContent:!t.displayAdditionalContent})}}),t.displayAdditionalContent&&(0,m.jsxs)(m.Fragment,{children:[t.postType.includes("event")&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Event Date"),checked:t.displayEventDate,onChange:()=>{o({displayEventDate:!t.displayEventDate})}}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Event Time"),checked:t.displayEventTime,onChange:()=>{o({displayEventTime:!t.displayEventTime})}})]}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Address"),checked:t.displayAddress,onChange:()=>{o({displayAddress:!t.displayAddress})}}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Website Link"),checked:t.displayWebsiteLink,onChange:()=>{o({displayWebsiteLink:!t.displayWebsiteLink})}}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Post Excerpt"),checked:t.displayExcerpt,onChange:()=>{o({displayExcerpt:!t.displayExcerpt,displayCustomExcerpt:!1})}}),t.displayExcerpt&&(0,m.jsx)(c.__experimentalNumberControl,{label:(0,r.__)("Excerpt Word Count"),value:t.excerptLength,min:0,onChange:e=>{o({excerptLength:Number(e)})}}),"queried_post"!==t.postType&&"kraken-core/content-card"===n&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Custom Excerpt"),checked:t.displayCustomExcerpt,onChange:()=>{o({displayExcerpt:!1,displayCustomExcerpt:!t.displayCustomExcerpt})}}),t.displayCustomExcerpt&&(0,m.jsx)(c.TextareaControl,{label:(0,r.__)("Customize Excerpt Text"),value:t.customExcerpt,onChange:e=>{o({customExcerpt:e})}})]}),(0,m.jsx)("hr",{}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Read More Text"),checked:t.displayReadMore,onChange:()=>{o({displayReadMore:!t.displayReadMore})}}),t.displayReadMore&&(0,m.jsx)(c.TextControl,{label:(0,r.__)("Customize Read More Text"),value:t.readMoreText,onChange:e=>{o({readMoreText:e})}}),(0,m.jsx)("hr",{}),(0,m.jsx)(c.ToggleControl,{label:(0,r.__)("Display Mindtrip CTA"),help:(0,r.__)("Requires Mindtrip integration"),checked:t.displayMindtripCta,onChange:()=>{o({displayMindtripCta:!t.displayMindtripCta})}}),t.displayMindtripCta&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.SelectControl,{label:(0,r.__)("Mindtrip CTA Type"),value:t.mindtripCtaType,options:[{label:"Button",value:"button"},{label:"Icon Only",value:"icon-only"}],onChange:e=>{o({mindtripCtaType:e})}}),(0,m.jsx)(c.TextControl,{label:(0,r.__)("Mindtrip CTA Text"),help:(0,r.__)("Sparkle added automatically"),value:t.mindtripCtaText,onChange:e=>{o({mindtripCtaText:e})}}),(0,m.jsx)(c.TextControl,{label:(0,r.__)("Mindtrip Prompt"),help:(0,r.__)("Use %postname% to output the post/listing name in your prompt. Defaults to `Explore things to do near %postname%`"),value:t.mindtripPrompt,onChange:e=>{o({mindtripPrompt:e})}})]}),(()=>{const e=KrakenThemeSettings.blockData.cardAttributes;return Object.keys(e).length>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("hr",{}),f(e,t,o,"customAdditionalContent")]})})()]})]})};function x(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?x(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):x(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _(e){let t="";return t=e.title&&e.title.raw?e.title.raw:e.title&&"string"==typeof e.title?e.title:e.title&&e.title.rendered?e.title.rendered:e.acf&&e.acf.post_title?e.acf.post_title:e.post_title||e.name||`Post ${e.id}`,function(e){if(!e)return e;const t=document.createElement("textarea");return t.innerHTML=e,t.value}(t)}const T=e=>{var t;const{attributes:o,setAttributes:n}=e,l=(0,s.useBlockProps)(),{posts:a,hasResolved:u}=(0,p.useSelect)(e=>{const t=["postType",o.postType,{per_page:50,status:"publish",order:"desc",orderby:"date"}];return"custom"!==o.postType&&"queried_post"!==o.postType?{posts:e(d.store).getEntityRecords(...t),hasResolved:e(d.store).hasFinishedResolution("getEntityRecords",t)}:{posts:null}},[o.postType]),[b,g]=(0,i.useState)([]),[f,j]=(0,i.useState)(!1),[x,T]=(0,i.useState)(""),O=(0,i.useCallback)(function(){let e;return function(...t){clearTimeout(e),e=setTimeout(()=>{clearTimeout(e),(async(e,t)=>{if(!e||e.length<2)return g([]),void j(!1);j(!0);try{const o=e.replace(/&/g,"&amp;");let n=t;"page"===t?n="pages":"post"===t&&(n="posts");const r=`/wp/v2/${n}?search=${encodeURIComponent(e)}&per_page=50&status=publish`;let l;if(e.includes("&")&&e!==o){const[e,t]=await Promise.all([y()({path:r}),y()({path:`/wp/v2/${n}?search=${encodeURIComponent(o)}&per_page=50&status=publish`})]),a=[...e,...t],s=new Set;l=a.filter(e=>!s.has(e.id)&&(s.add(e.id),!0))}else l=await y()({path:r});const a=l.map(e=>{const t=_(e);return{value:e.id,label:t}});g(a)}catch(e){console.error("Search error:",e),g([])}finally{j(!1)}})(...t)},300)}}(),[]),w=()=>{if(x&&x.length>=2)return b;let e=[];return a&&(e=a.map(e=>({value:e.id,label:_(e)}))),o.contentId&&o.contentTitle&&!e.some(e=>e.value===o.contentId)&&e.unshift({value:o.contentId,label:o.contentTitle}),a||"custom"===o.postType||"queried_post"===o.postType?e:o.contentId?[{label:(0,r.__)(o.contentTitle),value:o.contentId}]:[{value:0,label:(0,r.__)("Loading...")}]},[k,P]=(0,i.useState)(w());(0,i.useEffect)(()=>{P(w())},[a,b,x]);const E=(0,p.useSelect)(e=>{const t=["root","postType",{per_page:-1}];return{results:e(d.store).getEntityRecords(...t),hasStartedResolution:e(d.store).hasStartedResolution("getEntityRecords",t),hasFinishedResolution:e(d.store).hasFinishedResolution("getEntityRecords",t),isResolving:e(d.store).isResolving("getEntityRecords",t)}}),S=(()=>{const e=KrakenThemeSettings.blockData.ignoredPostTypes||{},t=e.add||[],o=e.remove||[];let n=["attachment","nav_menu_item","wp_block","wp_font_family","wp_font_face","wp_global_styles","wp_template","wp_template_part","wp_navigation","rm_content_editor","rank_math_schema"];return n=n.filter(e=>!o.includes(e)),t.forEach(e=>{n.push(e)}),n})(),D=null===(t=E.results)||void 0===t?void 0:t.filter(e=>!S.includes(e.slug)).map(e=>({label:e.labels.name,value:e.slug}));return Array.isArray(D)&&D.push({label:(0,r.__)("Custom","kraken-core"),value:"custom"}),Array.isArray(D)&&D.push({label:(0,r.__)("Queried Post","kraken-core"),value:"queried_post"}),(0,m.jsxs)("div",{className:`${l.className}`,children:[(0,m.jsx)(c.SelectControl,{label:(0,r.__)("Card Style"),value:o.cardStyle,options:h(),onChange:e=>{n({cardStyle:e})}}),(0,m.jsx)(c.SelectControl,{label:(0,r.__)("Content Type"),value:o.postType,options:D,onChange:e=>{n({postType:e})}}),"custom"===o.postType?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.TextControl,{label:(0,r.__)("Content Title"),value:o.contentTitle,onChange:e=>{n({contentTitle:e})}}),(0,m.jsx)(c.TextControl,{label:(0,r.__)("CTA Text"),value:o.customCtaText,onChange:e=>{n({customCtaText:e})}}),(0,m.jsx)(s.__experimentalLinkControl,{label:(0,r.__)("CTA URL"),value:o.customCtaUrl,onChange:e=>{n({customCtaUrl:e})}},e.clientId),(0,m.jsx)(s.MediaUploadCheck,{children:(0,m.jsx)(s.MediaUpload,{title:(0,r.__)("Upload Image"),allowedTypes:["image"],onSelect:e=>{n({customImage:{id:e.id,url:e.url}})},value:o.customImage.id,render:({open:e})=>(0,m.jsxs)("div",{className:"image-select",children:[(0,m.jsx)(c.Button,{onClick:e,isLarge:!0,icon:"format-gallery",children:(0,r.__)("Select Image")}),""!=o.customImage.url&&(0,m.jsx)(c.ResponsiveWrapper,{children:(0,m.jsx)("img",{src:o.customImage.url})})]})})})]}):(0,m.jsxs)(m.Fragment,{children:[u&&a&&a.length?(0,m.jsx)(c.ComboboxControl,{label:(0,r.__)("Select content"),options:k,value:o.contentId,onChange:e=>(e=>{if(e&&0!==e){let t=null==a?void 0:a.find(t=>t.id==e);if(!t&&b.length>0){let t=o.postType;return"page"===o.postType?t="pages":"post"===o.postType&&(t="posts"),void y()({path:`/wp/v2/${t}/${e}`}).then(e=>{const t=_(e);n({contentId:e.id,contentTitle:t,mode:"preview"})}).catch(e=>{console.error("Error fetching post:",e)})}if(t){const e=_(t);n({contentId:t.id,contentTitle:e,mode:"preview"})}}})(e),onFilterValueChange:e=>{T(e),O(e,o.postType)}}):(0,m.jsx)(m.Fragment,{children:"queried_post"!==o.postType&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.Spinner,{})," Loading options..."]})}),(0,m.jsx)("hr",{}),(0,m.jsx)(C,v({},e))]})]})};function O(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function w(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?O(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):O(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}const k=e=>(0,m.jsx)(s.InspectorControls,{children:(0,m.jsx)(c.Panel,{children:(0,m.jsx)(c.PanelBody,{title:"Options",children:(0,m.jsx)(T,w({},e))})})});function P(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}const E=e=>(0,m.jsx)(k,function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?P(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):P(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}({},e));function S(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function D(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?S(Object(o),!0).forEach(function(t){n(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):S(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}const I=e=>{const t=(0,s.useBlockProps)();return(0,m.jsx)("div",D(D({},t),{},{children:(0,m.jsx)(a(),D({block:e.name},e))}))},A=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"version":"1.1.0a","name":"kraken-core/content-card","title":"[Kraken] Content Card","description":"Display selected post or custom content in card format","icon":"embed-photo","category":"kraken-core","attributes":{"contentId":{"type":"number","default":0},"cardStyle":{"type":"string","default":"default"},"postType":{"type":"string","default":"post"},"contentTitle":{"type":"string","default":""},"backgroundColor":{"type":"string","default":""},"textColor":{"type":"string","default":""},"displayAdditionalContent":{"type":"boolean","default":false},"displayEventDate":{"type":"boolean","default":false},"displayEventTime":{"type":"boolean","default":false},"displayAddress":{"type":"boolean","default":false},"displayWebsiteLink":{"type":"boolean","default":false},"displayMindtripCta":{"type":"boolean","default":false},"mindtripCtaType":{"type":"string","default":"button"},"mindtripCtaText":{"type":"string","default":""},"mindtripPrompt":{"type":"string","default":""},"displayExcerpt":{"type":"boolean","default":false},"excerptLength":{"type":"number","default":12},"displayCustomExcerpt":{"type":"boolean","default":false},"customExcerpt":{"type":"string","default":""},"displayCustomTitle":{"type":"boolean","default":false},"customTitle":{"type":"string","default":""},"displayReadMore":{"type":"boolean","default":false},"readMoreText":{"type":"string","default":"Read More"},"displayCustomImage":{"type":"boolean","default":false},"eventDateBackgroundColor":{"type":"string","default":""},"eventDateTextColor":{"type":"string","default":""},"customImage":{"type":"object","default":{}},"customCtaText":{"type":"string","default":""},"customCtaUrl":{"type":"object","default":{}},"customAdditionalContent":{"type":"object","default":{}}},"example":{"attributes":{"contentId":1,"contentTitle":"Example Post"}},"supports":{"background":{"backgroundImage":true,"backgroundSize":true},"color":{"background":true,"text":true,"enableContrastChecker":true}},"editorScript":["file:./index.js"],"editorStyle":"file:./index.css","style":"file:./style-view.css","viewScript":"file:./view.js","render":"file:./render.php"}');(0,t.registerBlockType)(A,{edit:e=>{const{attributes:t,setAttributes:o}=e;return(0,i.useEffect)(()=>{var e;const n=(null===(e=KrakenThemeSettings)||void 0===e||null===(e=e.blockData)||void 0===e?void 0:e.cardAttributes)||{};if(t.customAdditionalContent&&Object.keys(t.customAdditionalContent).length>0){const e=((e,t)=>{const o=t.customAdditionalContent||{},n=Object.keys(e),r={};return n.forEach(e=>{o.hasOwnProperty(e)&&(r[e]=o[e])}),r})(n,t);Object.keys(e).length!==Object.keys(t.customAdditionalContent).length&&o({customAdditionalContent:e})}},[]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(E,D({},e)),(0,m.jsx)(I,D({},e))]})},save:()=>null})})();