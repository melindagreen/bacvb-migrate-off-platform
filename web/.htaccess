# Begin GzipofBreezeWPCache
<IfModule mod_env.c>
    SetEnv BREEZE_GZIP_ON 1
</IfModule>
<IfModule mod_deflate.c>
	AddType x-font/woff .woff
	AddOutputFilterByType DEFLATE text/plain
	AddOutputFilterByType DEFLATE image/svg+xml
	AddOutputFilterByType DEFLATE text/html
	AddOutputFilterByType DEFLATE text/xml
	AddOutputFilterByType DEFLATE text/css
	AddOutputFilterByType DEFLATE text/vtt
	AddOutputFilterByType DEFLATE text/x-component
	AddOutputFilterByType DEFLATE text/javascript
	AddOutputFilterByType DEFLATE application/js
	AddOutputFilterByType DEFLATE application/x-httpd-php
	AddOutputFilterByType DEFLATE application/x-httpd-fastphp
	AddOutputFilterByType DEFLATE application/atom+xml
	AddOutputFilterByType DEFLATE application/json
	AddOutputFilterByType DEFLATE application/ld+json
	AddOutputFilterByType DEFLATE application/x-web-app-manifest+json
	AddOutputFilterByType DEFLATE application/xml
	AddOutputFilterByType DEFLATE application/xhtml+xml
	AddOutputFilterByType DEFLATE application/rss+xml
	AddOutputFilterByType DEFLATE application/javascript
	AddOutputFilterByType DEFLATE application/x-javascript
	AddOutputFilterByType DEFLATE application/x-font-ttf
	AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
	AddOutputFilterByType DEFLATE font/opentype
	AddOutputFilterByType DEFLATE font/ttf
	AddOutputFilterByType DEFLATE font/eot font/otf
	AddOutputFilterByType DEFLATE font/otf
	AddOutputFilterByType DEFLATE font/woff
	AddOutputFilterByType DEFLATE application/x-font-woff
	AddOutputFilterByType DEFLATE application/font-woff2
	AddOutputFilterByType DEFLATE image/x-icon
</IfModule>
# End GzipofBreezeWPCache

#Expires headers configuration - UPDATED for proper cache control
<IfModule mod_headers.c>
    # DEFAULT: Do not cache anything - no-cache means "revalidate before use"
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"

    # STATIC ASSETS: Cache for 1 year with immutable flag
    <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot|otf)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
        Header unset Pragma
        Header unset Expires
    </FilesMatch>

    # MEDIA FILES: Cache for 1 year
    <FilesMatch "\.(mp4|webm|ogg|wav|mp3)$">
        Header set Cache-Control "public, max-age=31536000"
        Header unset Pragma
    </FilesMatch>

    # HTML/PHP - Do not cache (always revalidate)
    <FilesMatch "\.(html|php)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>

    # API endpoints - Never cache
    <DirectoryMatch "wp-json|/api/">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </DirectoryMatch>
</IfModule>

<IfModule mod_env.c>
   SetEnv BREEZE_BROWSER_CACHE_ON 1
</IfModule>

<IfModule mod_expires.c>
   ExpiresActive On
   # DEFAULT: Don't cache
   ExpiresDefault "access plus 0 seconds"

   # Assets - 1 year
   ExpiresByType text/css "access plus 1 year"
   ExpiresByType application/javascript "access plus 1 year"
   ExpiresByType application/x-javascript "access plus 1 year"
   ExpiresByType text/javascript "access plus 1 year"
   # Media assets - 1 year
   ExpiresByType audio/ogg "access plus 1 year"
   ExpiresByType image/bmp "access plus 1 year"
   ExpiresByType image/gif "access plus 1 year"
   ExpiresByType image/jpeg "access plus 1 year"
   ExpiresByType image/png "access plus 1 year"
   ExpiresByType image/svg+xml "access plus 1 year"
   ExpiresByType image/webp "access plus 1 year"
   ExpiresByType video/mp4 "access plus 1 year"
   ExpiresByType video/ogg "access plus 1 year"
   ExpiresByType video/webm "access plus 1 year"
   # Font assets - 1 year
   ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
   ExpiresByType font/eot "access plus 1 year"
   ExpiresByType font/opentype "access plus 1 year"
   ExpiresByType application/x-font-ttf "access plus 1 year"
   ExpiresByType application/font-woff "access plus 1 year"
   ExpiresByType application/x-font-woff "access plus 1 year"
   ExpiresByType font/woff "access plus 1 year"
   ExpiresByType application/font-woff2 "access plus 1 year"
   # Data interchange - Never cache
   ExpiresByType application/xml "access plus 0 seconds"
   ExpiresByType application/json "access plus 0 seconds"
   ExpiresByType application/ld+json "access plus 0 seconds"
   ExpiresByType application/schema+json "access plus 0 seconds"
   ExpiresByType application/vnd.geo+json "access plus 0 seconds"
   ExpiresByType text/xml "access plus 0 seconds"
   ExpiresByType application/rss+xml "access plus 1 hour"
   ExpiresByType application/rdf+xml "access plus 1 hour"
   ExpiresByType application/atom+xml "access plus 1 hour"
   # Manifest files
   ExpiresByType application/manifest+json "access plus 1 week"
   ExpiresByType application/x-web-app-manifest+json "access plus 0 seconds"
   ExpiresByType text/cache-manifest  "access plus 0 seconds"
   # Favicon - 1 week
   ExpiresByType image/vnd.microsoft.icon "access plus 1 week"
   ExpiresByType image/x-icon "access plus 1 week"
   # HTML/PHP - Never cache
   ExpiresByType text/html "access plus 0 seconds"
   # Other
   ExpiresByType application/xhtml-xml "access plus 0 seconds"
   ExpiresByType application/pdf "access plus 1 month"
   ExpiresByType application/x-shockwave-flash "access plus 1 month"
   ExpiresByType text/x-cross-domain-policy "access plus 1 week"
</IfModule>
#End of expires headers configuration

# BEGIN WordPress
# The directives (lines) between "BEGIN WordPress" and "END WordPress" are
# dynamically generated, and should only be modified via WordPress filters.
# Any changes to the directives between these markers will be overwritten.
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]

# add a trailing slash to /wp-admin
RewriteRule ^([_0-9a-zA-Z-]+/)?wp-admin$ $1wp-admin/ [R=301,L]

RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle subsite rewrites (The key part for subdirectories)
RewriteRule ^([_0-9a-zA-Z-]+/)?(wp-(content|admin|includes).*) $2 [L]
RewriteRule ^([_0-9a-zA-Z-]+/)?(.*\.php)$ $2 [L]

RewriteRule . index.php [L]

</IfModule>
# END WordPress
